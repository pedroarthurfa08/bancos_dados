-- This script was generated by the ERD tool in pgAdmin 4.
-- Please log an issue at https://github.com/pgadmin-org/pgadmin4/issues/new/choose if you find any bugs, including reproduction steps.
BEGIN;


CREATE TABLE IF NOT EXISTS livraria.livro
(
    isbn numeric(13, 0) NOT NULL,
    codigo_livro numeric(15, 0) NOT NULL,
    titulo_livro character varying(50) NOT NULL,
    decricao_livro character varying(500) NOT NULL,
    "preço_livro" numeric(7, 2) NOT NULL,
    PRIMARY KEY (isbn, codigo_livro)
);

CREATE TABLE IF NOT EXISTS livraria.atores
(
    nome character varying(15) NOT NULL,
    sobrenome character varying(15) NOT NULL,
    codigo_autor numeric(15) NOT NULL,
    PRIMARY KEY (codigo_autor)
);

CREATE TABLE IF NOT EXISTS livraria.categoria
(
    codigo_categoria numeric(15, 0) NOT NULL,
    descricao_categoria character varying(20) NOT NULL,
    PRIMARY KEY (codigo_categoria)
);

CREATE TABLE IF NOT EXISTS livraria.cliente
(
    id_cliente numeric(15, 0) NOT NULL,
    nome_cliente character varying(50) NOT NULL,
    email_cliente character varying(40) NOT NULL,
    "endereço_cliente" character varying NOT NULL,
    PRIMARY KEY (id)
);

CREATE TABLE IF NOT EXISTS livraria.pedido
(
    id_pedido numeric(15, 0) NOT NULL,
    data date NOT NULL,
    PRIMARY KEY (id_pedido)
);

CREATE TABLE IF NOT EXISTS livraria."endereço"
(
    cep numeric(10, 0) NOT NULL,
    lagradouro character varying(40) NOT NULL,
    numero numeric(5, 0) NOT NULL,
    bairro character varying(15) NOT NULL,
    PRIMARY KEY (cep)
);

CREATE TABLE IF NOT EXISTS livraria.livro_atores
(
    livro_codigo_livro numeric(15, 0) NOT NULL,
    atores_codigo_autor numeric(15) NOT NULL
);

CREATE TABLE IF NOT EXISTS livraria.livro_categoria
(
    livro_codigo_livro numeric(15, 0) NOT NULL,
    categoria_codigo_categoria numeric(15, 0) NOT NULL
);

ALTER TABLE IF EXISTS livraria.cliente
    ADD FOREIGN KEY ("endereço_cliente")
    REFERENCES livraria."endereço" (cep) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS livraria.pedido
    ADD FOREIGN KEY (id_pedido)
    REFERENCES livraria.cliente (id_cliente) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS livraria.pedido
    ADD FOREIGN KEY (id_pedido)
    REFERENCES livraria.livro (codigo_livro) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS livraria.livro_atores
    ADD FOREIGN KEY (livro_codigo_livro)
    REFERENCES livraria.livro (codigo_livro) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS livraria.livro_atores
    ADD FOREIGN KEY (atores_codigo_autor)
    REFERENCES livraria.atores (codigo_autor) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS livraria.livro_categoria
    ADD FOREIGN KEY (livro_codigo_livro)
    REFERENCES livraria.livro (codigo_livro) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;


ALTER TABLE IF EXISTS livraria.livro_categoria
    ADD FOREIGN KEY (categoria_codigo_categoria)
    REFERENCES livraria.categoria (codigo_categoria) MATCH SIMPLE
    ON UPDATE NO ACTION
    ON DELETE NO ACTION
    NOT VALID;

END;